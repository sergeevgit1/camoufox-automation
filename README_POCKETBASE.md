# ๐ PocketBase Authentication Integration

ะะฐะฝะฝัะน ะฟัะพะตะบั ะธัะฟะพะปัะทัะตั **PocketBase** ะบะฐะบ ะฟะพะปะฝะพัะตะฝะฝะพะต opensource ัะตัะตะฝะธะต ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ ะธ ััะฐะฝะตะฝะธั ะดะฐะฝะฝัั. PocketBase ะทะฐะผะตะฝัะตั ะบะฐะบ OAuth ะฟัะพะฒะฐะนะดะตั, ัะฐะบ ะธ MySQL ะฑะฐะทั ะดะฐะฝะฝัั, ะฟัะตะดะพััะฐะฒะปัั ะฒัะต ะฝะตะพะฑัะพะดะธะผะพะต ะฒ ะพะดะฝะพะผ ะปะตะณะบะพะฒะตัะฝะพะผ ะฟะฐะบะตัะต.

## ๐ฏ ะะพัะตะผั PocketBase?

**PocketBase** โ ััะพ ัะพะฒัะตะผะตะฝะฝะพะต opensource ัะตัะตะฝะธะต, ะบะพัะพัะพะต ะฟัะตะดะพััะฐะฒะปัะตั:

- โ **ะัััะพะตะฝะฝัั ะฐััะตะฝัะธัะธะบะฐัะธั** โ email/password, OAuth2 (Google, GitHub, Facebook ะธ ะดั.), OTP
- โ **ะะฐะทั ะดะฐะฝะฝัั SQLite** โ ะฑััััะฐั, ะฝะฐะดะตะถะฝะฐั, ะฝะต ััะตะฑัะตั ะพัะดะตะปัะฝะพะณะพ ัะตัะฒะตัะฐ
- โ **Admin UI** โ ะฒะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ ะธ ะดะฐะฝะฝัะผะธ
- โ **Realtime API** โ WebSocket ะดะปั live ะพะฑะฝะพะฒะปะตะฝะธะน
- โ **File storage** โ ะฒัััะพะตะฝะฝะพะต ััะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ
- โ **ะัะปะตะฒะฐั ะบะพะฝัะธะณััะฐัะธั** โ ัะฐะฑะพัะฐะตั ะธะท ะบะพัะพะฑะบะธ ะฑะตะท OAuth credentials
- โ **ะะตะณะบะพะฒะตัะฝะพััั** โ ะพะดะธะฝ ะฑะธะฝะฐัะฝัะน ัะฐะนะป ~15MB

## ๐๏ธ ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   ะัะฐัะทะตั                       โ
โ            http://localhost:6000                โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          Express + React App (Port 6000)        โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Frontend (React)                        โ   โ
โ  โ  - Login/Register UI                     โ   โ
โ  โ  - Browser automation interface          โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Backend (Express + tRPC)                โ   โ
โ  โ  - Authentication routes                 โ   โ
โ  โ  - Browser automation logic              โ   โ
โ  โ  - Camoufox integration                  โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                 โ PocketBase JS SDK
                 โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ        PocketBase (Port 8090)                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Authentication                          โ   โ
โ  โ  - Email/Password                        โ   โ
โ  โ  - OAuth2 (Google, GitHub, etc.)         โ   โ
โ  โ  - JWT tokens                            โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Database (SQLite)                       โ   โ
โ  โ  - users                                 โ   โ
โ  โ  - profiles (browser profiles)           โ   โ
โ  โ  - sessions (automation sessions)        โ   โ
โ  โ  - tasks (automation tasks)              โ   โ
โ  โ  - apiKeys (n8n integration)             โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Admin UI                                โ   โ
โ  โ  http://localhost:8090/_/                โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฆ ะกัััะบัััะฐ ะดะฐะฝะฝัั

### Collections (ะขะฐะฑะปะธัั)

#### 1. **users** (ะฒัััะพะตะฝะฝะฐั auth ะบะพะปะปะตะบัะธั)
- `id` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `email` - email ะฟะพะปัะทะพะฒะฐัะตะปั
- `name` - ะธะผั ะฟะพะปัะทะพะฒะฐัะตะปั
- `password` - ัะตัะธัะพะฒะฐะฝะฝัะน ะฟะฐัะพะปั
- `role` - ัะพะปั (user/admin)
- `verified` - ะฟะพะดัะฒะตัะถะดะตะฝะธะต email
- `created` - ะดะฐัะฐ ัะพะทะดะฐะฝะธั
- `updated` - ะดะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั

#### 2. **profiles** (ะฟัะพัะธะปะธ ะฑัะฐัะทะตัะพะฒ)
- `id` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `userId` - ัะฒัะทั ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ
- `name` - ะฝะฐะทะฒะฐะฝะธะต ะฟัะพัะธะปั
- `tags` - ัะตะณะธ ะดะปั ะณััะฟะฟะธัะพะฒะบะธ
- `fingerprint` - ะฝะฐัััะพะนะบะธ ะพัะฟะตัะฐัะบะฐ ะฑัะฐัะทะตัะฐ (JSON)
- `cookies` - ัะพััะฐะฝะตะฝะฝัะต cookies (JSON)
- `localStorage` - ะดะฐะฝะฝัะต localStorage (JSON)
- `sessionStorage` - ะดะฐะฝะฝัะต sessionStorage (JSON)
- `proxy` - ะฝะฐัััะพะนะบะธ ะฟัะพะบัะธ (JSON)
- `userAgent` - User-Agent
- `viewport` - ัะฐะทะผะตั ะพะบะฝะฐ
- `timezone` - ัะฐัะพะฒะพะน ะฟะพัั
- `locale` - ะปะพะบะฐะปั
- `geolocation` - ะณะตะพะปะพะบะฐัะธั
- `notes` - ะทะฐะผะตัะบะธ
- `lastUsed` - ะฟะพัะปะตะดะฝะตะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต

#### 3. **sessions** (ัะตััะธะธ ะฐะฒัะพะผะฐัะธะทะฐัะธะธ)
- `id` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `userId` - ัะฒัะทั ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ
- `profileId` - ัะฒัะทั ั ะฟัะพัะธะปะตะผ (ะพะฟัะธะพะฝะฐะปัะฝะพ)
- `name` - ะฝะฐะทะฒะฐะฝะธะต ัะตััะธะธ
- `status` - ััะฐััั (active/stopped/error)
- `browserConfig` - ะบะพะฝัะธะณััะฐัะธั ะฑัะฐัะทะตัะฐ (JSON)
- `created` - ะดะฐัะฐ ัะพะทะดะฐะฝะธั
- `updated` - ะดะฐัะฐ ะพะฑะฝะพะฒะปะตะฝะธั

#### 4. **tasks** (ะทะฐะดะฐัะธ ะฐะฒัะพะผะฐัะธะทะฐัะธะธ)
- `id` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `sessionId` - ัะฒัะทั ั ัะตััะธะตะน
- `userId` - ัะฒัะทั ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ
- `action` - ะดะตะนััะฒะธะต (navigate, click, screenshot ะธ ั.ะด.)
- `parameters` - ะฟะฐัะฐะผะตััั ะดะตะนััะฒะธั (JSON)
- `status` - ััะฐััั (pending/running/completed/failed)
- `result` - ัะตะทัะปััะฐั ะฒัะฟะพะปะฝะตะฝะธั (JSON)
- `error` - ะพัะธะฑะบะฐ (ะตัะปะธ ะตััั)
- `completed` - ะดะฐัะฐ ะทะฐะฒะตััะตะฝะธั

#### 5. **apiKeys** (API ะบะปััะธ ะดะปั n8n)
- `id` - ัะฝะธะบะฐะปัะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั
- `userId` - ัะฒัะทั ั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ
- `key` - API ะบะปัั
- `name` - ะฝะฐะทะฒะฐะฝะธะต ะบะปััะฐ
- `lastUsed` - ะฟะพัะปะตะดะฝะตะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต
- `created` - ะดะฐัะฐ ัะพะทะดะฐะฝะธั

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐะฟััะบ ั Docker Compose

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/sergeevgit1/camoufox-automation.git
cd camoufox-automation

# ะกะพะทะดะฐัั .env ัะฐะนะป (ะพะฟัะธะพะฝะฐะปัะฝะพ, ัะฐะฑะพัะฐะตั ะธ ะฑะตะท ะฝะตะณะพ)
cp .env.example .env

# ะะฐะฟัััะธัั ะฒัะต ัะตัะฒะธัั
docker compose up -d

# ะัะพะฒะตัะธัั ััะฐััั
docker compose ps
```

### 2. ะะตัะฒะพะฝะฐัะฐะปัะฝะฐั ะฝะฐัััะพะนะบะฐ PocketBase

ะะพัะปะต ะทะฐะฟััะบะฐ ะพัะบัะพะนัะต PocketBase Admin UI:
```
http://localhost:8090/_/
```

**ะัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต:**
1. ะกะพะทะดะฐะนัะต admin ะฐะบะบะฐัะฝั (email + ะฟะฐัะพะปั)
2. ะกัะตะผะฐ ะฑะฐะทั ะดะฐะฝะฝัั ัะพะทะดะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท hooks
3. ะะพะถะตัะต ัะพะทะดะฐัั ัะตััะพะฒะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ัะตัะตะท UI ะธะปะธ API

### 3. ะะพัััะฟ ะบ ะฟัะธะปะพะถะตะฝะธั

ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต ะฒ ะฑัะฐัะทะตัะต:
```
http://localhost:6000
```

ะขะตะฟะตัั ะฒั ะผะพะถะตัะต:
- ะะฐัะตะณะธัััะธัะพะฒะฐัััั ัะตัะตะท ัะพัะผั ัะตะณะธัััะฐัะธะธ
- ะะพะนัะธ ัะตัะตะท email/password
- ะัะฟะพะปัะทะพะฒะฐัั OAuth2 (ะตัะปะธ ะฝะฐัััะพะตะฝะพ ะฒ PocketBase)

## ๐ ะััะตะฝัะธัะธะบะฐัะธั

### Email/Password

**ะะตะณะธัััะฐัะธั:**
```bash
curl -X POST http://localhost:6000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123",
    "name": "John Doe"
  }'
```

**ะัะพะด:**
```bash
curl -X POST http://localhost:6000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123"
  }'
```

**ะะพะปััะธัั ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั:**
```bash
curl http://localhost:6000/api/auth/me \
  -H "Cookie: session=YOUR_SESSION_TOKEN"
```

**ะััะพะด:**
```bash
curl -X POST http://localhost:6000/api/auth/logout \
  -H "Cookie: session=YOUR_SESSION_TOKEN"
```

### OAuth2 (Google, GitHub, Facebook)

PocketBase ะฟะพะดะดะตัะถะธะฒะฐะตั OAuth2 ะธะท ะบะพัะพะฑะบะธ. ะะปั ะฝะฐัััะพะนะบะธ:

1. ะัะบัะพะนัะต PocketBase Admin UI: `http://localhost:8090/_/`
2. ะะตัะตะนะดะธัะต ะฒ **Settings โ Auth providers**
3. ะะบะปััะธัะต ะฝัะถะฝัะต ะฟัะพะฒะฐะนะดะตัั (Google, GitHub, Facebook, etc.)
4. ะะพะฑะฐะฒััะต Client ID ะธ Client Secret ะพั ะฟัะพะฒะฐะนะดะตัะฐ
5. ะัะฟะพะปัะทัะนัะต redirect URL: `http://localhost:8090/api/oauth2-redirect`

ะะพัะปะต ะฝะฐัััะพะนะบะธ ะฟะพะปัะทะพะฒะฐัะตะปะธ ัะผะพะณัั ะฒัะพะดะธัั ัะตัะตะท OAuth2.

## ๐ง ะฃะฟัะฐะฒะปะตะฝะธะต ะดะฐะฝะฝัะผะธ

### ะงะตัะตะท PocketBase Admin UI

ะกะฐะผัะน ะฟัะพััะพะน ัะฟะพัะพะฑ ัะฟัะฐะฒะปะตะฝะธั ะดะฐะฝะฝัะผะธ:

1. ะัะบัะพะนัะต `http://localhost:8090/_/`
2. ะะพะนะดะธัะต ะบะฐะบ admin
3. ะฃะฟัะฐะฒะปัะนัะต ะฟะพะปัะทะพะฒะฐัะตะปัะผะธ, ะฟัะพัะธะปัะผะธ, ัะตััะธัะผะธ ัะตัะตะท UI

### ะงะตัะตะท API

PocketBase ะฟัะตะดะพััะฐะฒะปัะตั ะฟะพะปะฝัะน REST API:

**ะกะพะทะดะฐัั ะฟัะพัะธะปั ะฑัะฐัะทะตัะฐ:**
```javascript
const pb = new PocketBase('http://localhost:8090');

// ะััะตะฝัะธัะธะบะฐัะธั
await pb.collection('users').authWithPassword('user@example.com', 'password');

// ะกะพะทะดะฐัั ะฟัะพัะธะปั
const profile = await pb.collection('profiles').create({
  userId: pb.authStore.record.id,
  name: 'My Profile',
  fingerprint: {
    os: 'windows',
    locale: 'en-US',
    timezone: 'America/New_York'
  },
  userAgent: 'Mozilla/5.0...',
  viewport: '1920x1080'
});
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### API Rules

PocketBase ะธัะฟะพะปัะทัะตั ะฟัะฐะฒะธะปะฐ ะดะพัััะฟะฐ ะดะปั ะทะฐัะธัั ะดะฐะฝะฝัั. ะัะต ะบะพะปะปะตะบัะธะธ ะฝะฐัััะพะตะฝั ัะฐะบ, ััะพ:

- ะะพะปัะทะพะฒะฐัะตะปะธ ะฒะธะดัั ัะพะปัะบะพ ัะฒะพะธ ะดะฐะฝะฝัะต
- ะกะพะทะดะฐะฝะธะต/ะพะฑะฝะพะฒะปะตะฝะธะต/ัะดะฐะปะตะฝะธะต ะดะพัััะฟะฝะพ ัะพะปัะบะพ ะฒะปะฐะดะตะปััั
- Admin ะธะผะตะตั ะฟะพะปะฝัะน ะดะพัััะฟ ะบะพ ะฒัะตะผ ะดะฐะฝะฝัะผ

### ะัะฐะฒะธะปะฐ ะฟะพ ัะผะพะปัะฐะฝะธั:

```javascript
// ะัะธะผะตั ะฟัะฐะฒะธะปะฐ ะดะปั profiles
listRule: "@request.auth.id != '' && userId = @request.auth.id"
viewRule: "@request.auth.id != '' && userId = @request.auth.id"
createRule: "@request.auth.id != ''"
updateRule: "@request.auth.id != '' && userId = @request.auth.id"
deleteRule: "@request.auth.id != '' && userId = @request.auth.id"
```

### ะะตะบะพะผะตะฝะดะฐัะธะธ ะดะปั production:

1. **ะะทะผะตะฝะธัะต COOKIE_SECRET** ะฒ `.env` ะฝะฐ ัะปััะฐะนะฝัั ัััะพะบั
2. **ะัะฟะพะปัะทัะนัะต HTTPS** ะดะปั production ัะฐะทะฒะตัััะฒะฐะฝะธั
3. **ะะฐัััะพะนัะต firewall** ะดะปั ะพะณัะฐะฝะธัะตะฝะธั ะดะพัััะฟะฐ ะบ PocketBase
4. **ะะตะณัะปััะฝะพ ะดะตะปะฐะนัะต backup** SQLite ะฑะฐะทั ะดะฐะฝะฝัั
5. **ะะบะปััะธัะต email verification** ะฒ PocketBase settings

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะปะพะณะธ

### ะัะพัะผะพัั ะปะพะณะพะฒ

```bash
# ะะพะณะธ ะฟัะธะปะพะถะตะฝะธั
docker compose logs -f app

# ะะพะณะธ PocketBase
docker compose logs -f pocketbase

# ะัะต ะปะพะณะธ
docker compose logs -f
```

### ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั

```bash
# ะกัะฐััั ะบะพะฝัะตะนะฝะตัะพะฒ
docker compose ps

# ะัะพะฒะตัะบะฐ PocketBase
curl http://localhost:8090/api/health

# ะัะพะฒะตัะบะฐ ะฟัะธะปะพะถะตะฝะธั
curl http://localhost:6000/api/auth/me
```

## ๐ ะะธะณัะฐัะธั ั MySQL

ะัะปะธ ั ะฒะฐั ัะถะต ะตััั ะดะฐะฝะฝัะต ะฒ MySQL, ะฒั ะผะพะถะตัะต ะผะธะณัะธัะพะฒะฐัั ะธั ะฒ PocketBase:

1. ะญะบัะฟะพััะธััะนัะต ะดะฐะฝะฝัะต ะธะท MySQL
2. ะัะฟะพะปัะทัะนัะต PocketBase Admin UI ะดะปั ะธะผะฟะพััะฐ
3. ะะปะธ ะฝะฐะฟะธัะธัะต ัะบัะธะฟั ะผะธะณัะฐัะธะธ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ PocketBase SDK

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะธัั ะทะฐะฒะธัะธะผะพััะธ
pnpm install

# ะะฐะฟัััะธัั PocketBase ะปะพะบะฐะปัะฝะพ
docker compose up pocketbase -d

# ะะฐะฟัััะธัั dev ัะตัะฒะตั
pnpm dev
```

### ะะฐััะธัะตะฝะธะต ััะตะผั

ะะปั ะดะพะฑะฐะฒะปะตะฝะธั ะฝะพะฒัั ะฟะพะปะตะน ะธะปะธ ะบะพะปะปะตะบัะธะน:

1. ะััะตะดะฐะบัะธััะนัะต `pocketbase/pb_hooks/main.pb.js`
2. ะะปะธ ะธัะฟะพะปัะทัะนัะต PocketBase Admin UI
3. ะะตัะตะทะฐะฟัััะธัะต ะบะพะฝัะตะนะฝะตั: `docker compose restart pocketbase`

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [PocketBase Documentation](https://pocketbase.io/docs/)
- [PocketBase JavaScript SDK](https://github.com/pocketbase/js-sdk)
- [PocketBase API Reference](https://pocketbase.io/docs/api-records/)
- [PocketBase GitHub](https://github.com/pocketbase/pocketbase)

## ๐ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### PocketBase ะฝะต ะทะฐะฟััะบะฐะตััั

```bash
# ะัะพะฒะตัะธัั ะปะพะณะธ
docker compose logs pocketbase

# ะะตัะตัะพะทะดะฐัั ะบะพะฝัะตะนะฝะตั
docker compose down
docker compose up pocketbase -d
```

### ะัะธะฑะบะธ ะฐััะตะฝัะธัะธะบะฐัะธะธ

```bash
# ะัะพะฒะตัะธัั, ััะพ PocketBase ะดะพัััะฟะตะฝ
curl http://localhost:8090/api/health

# ะัะพะฒะตัะธัั ะฟะพะดะบะปััะตะฝะธะต ะธะท app ะบะพะฝัะตะนะฝะตัะฐ
docker compose exec app ping pocketbase
```

### ะะพัะตัั ะดะฐะฝะฝัั

```bash
# Backup ะฑะฐะทั ะดะฐะฝะฝัั
docker compose exec pocketbase cp /pb_data/data.db /pb_data/backup.db

# Restore ะธะท backup
docker compose exec pocketbase cp /pb_data/backup.db /pb_data/data.db
docker compose restart pocketbase
```

## ๐ ะะธัะตะฝะทะธั

MIT
